# Bug #010: ライブラリのページネーションが不正なページ数を表示

**ステータス**: 🟡 進行中
**優先度**: Medium
**担当**: AIエージェント
**作成日**: 2025-10-27
**開始日時**: 2025-10-27 23:30
**完了日**: -

## 🐛 バグ概要

ライブラリにおいて、現在1件しか楽曲が表示されていないにもかかわらず、ページネーションが50ページ分表示されている。
デフォルトの楽曲数は10曲で固定し、11曲以上になったら2ページ目が発生するように修正する必要がある。

## 📍 発生環境

- ブラウザ: 未確認
- OS: 未確認
- URL: ライブラリページ
- バージョン: -

## 🔄 再現手順

1. ライブラリページにアクセス
2. 楽曲が1件のみ存在する状態を確認
3. ページネーションコンポーネントを確認
4. 50ページ分のページネーションが表示されていることを確認

## ❌ 期待される動作

- 1ページあたり10曲を表示
- 楽曲が1-10件の場合: ページネーションは表示されない、または1ページのみ
- 楽曲が11件以上の場合: 2ページ目以降が表示される
- 総ページ数 = ceil(総楽曲数 / 10)

## 🚨 実際の動作

- 楽曲が1件しかないにもかかわらず、50ページ分のページネーションが表示される
- ページ数の計算ロジックが正しく動作していない

## 📸 スクリーンショット/ログ

未添付

## 🔍 原因分析

ページネーションコンポーネントに渡している`total`の値が固定で1000になっていたことが原因。実際にデータベースから楽曲の総数を取得せず、ハードコードされた値を使用していたため、1件しか楽曲がないのに50ページ分（1000÷20=50）のページネーションが表示されていた。

また、チケットの要件では「1ページあたり10曲」だが、デフォルトのlimitが20に設定されていた。

### 問題箇所
- `app/library/page.tsx:105` - `<Pagination total={1000} ... />`
- `lib/db/queries.ts:29` - `limit = 20`（デフォルト値）

## ✅ 修正内容

- [x] 修正コミット: 後で記録
- [x] 影響範囲: ページネーション表示、1ページあたりの表示件数
- [x] テスト実施: 本番環境で動作確認予定

### 修正詳細

1. **`lib/db/queries.ts`**:
   - `getMusicCount`関数を追加: フィルター条件に応じた楽曲の総数を取得
   - `getMusicList`のデフォルトlimitを20→10に変更

2. **`app/library/page.tsx`**:
   - `getMusicCount`をインポート
   - ページ読み込み時に`getMusicCount`で実際の楽曲総数を取得
   - デフォルトlimitを'20'→'10'に変更
   - `<Pagination total={totalCount} ... />`に変更（固定値1000→動的な総数）

### 修正効果
- フィルター条件に応じた正しいページ数が表示される
- 1ページあたり10曲表示に変更
- 楽曲が1件の場合、ページネーションは表示されない（totalPages <= 1のため）

## 🧪 テスト確認項目

- [ ] 楽曲1件の場合、ページネーションが表示されない、または1ページのみ表示される
- [ ] 楽曲10件の場合、ページネーションが表示されない、または1ページのみ表示される
- [ ] 楽曲11件の場合、2ページ表示される
- [ ] 楽曲20件の場合、2ページ表示される
- [ ] 楽曲21件の場合、3ページ表示される
- [ ] ページ遷移が正常に動作する
- [ ] 各ページで正しい楽曲が表示される

## 📝 メモ

チケット作成日: 2025-10-27
修正実施日: 2025-10-27 23:45
修正者: AIエージェント

ページネーション計算ロジックの見直しを実施。
1ページあたりの表示件数(10件)を基準に総ページ数を算出するように修正完了。
本番環境でのテスト確認待ち。

## 🔗 関連

- 関連Issue: -
- 関連PR: -
- 参考資料: -
