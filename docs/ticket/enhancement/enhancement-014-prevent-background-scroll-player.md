# Enhancement #014: フルスクリーン音楽プレイヤー表示時の背景スクロール防止と背景透過の無効化

**ステータス**: 🟡 進行中
**カテゴリ**: UX
**優先度**: Medium
**担当**: AIエージェント
**作成日**: 2025-10-28
**開始日時**: 2025-10-28 13:45
**完了日**: -

## 🔧 改善概要

音楽プレイヤーをフルスクリーンで表示している際、背景レイヤー(下層ページ)のスクロールやスライド操作を無効化し、プレイヤーの背景を完全に不透明にする。

## 🎯 目的・背景

フルスクリーン音楽プレイヤー使用時のUX向上:
- ユーザーがプレイヤー操作に集中できるようにする
- 意図しない背景スクロールによる操作ミスを防止
- プレイヤーの視認性を向上させる

## 📊 現状の問題点

1. **背景スクロール問題**:
   - フルスクリーンプレイヤー表示中でも、背景のページがスクロール・スライド可能
   - ユーザーがプレイヤー上でスワイプ操作をした際に、背景が動いてしまう
   - プレイヤー操作の妨げになり、UXを損なっている

2. **背景透過問題**:
   - プレイヤー背景が透過しており、下層のコンテンツが見える
   - プレイヤーコンテンツの視認性が低下する可能性がある
   - フルスクリーン体験としての没入感が不足

## 💡 改善後の期待値

1. **スクロール制御**:
   - フルスクリーンプレイヤー表示中は背景が完全に固定される
   - スワイプ操作がプレイヤー内の操作のみに適用される
   - 操作性が向上し、ユーザーの混乱が解消される

2. **視認性向上**:
   - プレイヤー背景が完全に不透明になる
   - プレイヤー内のコンテンツが明確に見える
   - フルスクリーン体験としての没入感が向上

## 🔧 改善方法

### アプローチ

**1. 背景スクロール防止**:
- フルスクリーンプレイヤーが開いた時に `document.body` に `overflow: hidden` を適用
- プレイヤーが閉じた時に元のスタイルに戻す
- モバイルデバイスでのタッチスクロールも無効化

**2. 背景不透明化**:
- プレイヤーコンテナの背景色を完全に不透明に設定
- 必要に応じてオーバーレイ背景を追加

### 技術的な詳細

```typescript
// プレイヤー開閉時のbody制御
useEffect(() => {
  if (isFullscreen) {
    // スクロール無効化
    document.body.style.overflow = 'hidden';
    document.body.style.position = 'fixed';
    document.body.style.width = '100%';
  } else {
    // スクロール復元
    document.body.style.overflow = '';
    document.body.style.position = '';
    document.body.style.width = '';
  }

  return () => {
    // クリーンアップ
    document.body.style.overflow = '';
    document.body.style.position = '';
    document.body.style.width = '';
  };
}, [isFullscreen]);
```

```css
/* プレイヤー背景の不透明化 */
.fullscreen-player {
  background-color: rgb(0, 0, 0); /* 完全に不透明 */
  /* または */
  background-color: rgba(0, 0, 0, 1); /* アルファ値1.0 */
}
```

## ✅ 実装タスク

- [ ] フルスクリーンプレイヤーの状態管理を確認
- [ ] body要素へのスクロール制御ロジックを実装
- [ ] プレイヤー背景の不透明化スタイルを適用
- [ ] モバイルデバイスでの動作確認
- [ ] デスクトップでの動作確認
- [ ] プレイヤー開閉時のスタイル復元を確認

## 📦 変更対象ファイル

- [ ] `components/MusicPlayer.tsx` または該当するプレイヤーコンポーネント - スクロール制御ロジック追加
- [ ] プレイヤーのスタイルファイル - 背景不透明化のスタイル適用

## 🧪 ビフォー・アフター比較

| 指標 | Before | After | 改善 |
|------|--------|-------|------|
| 背景スクロール | 可能 | 不可能 | ✅ 固定化 |
| 背景透過 | あり | なし | ✅ 不透明化 |
| プレイヤー視認性 | やや低い | 高い | ✅ 向上 |
| 操作の集中度 | やや低い | 高い | ✅ 向上 |

## 🎯 完了条件

- [ ] フルスクリーンプレイヤー表示中、背景がスクロールしない
- [ ] プレイヤーを閉じた後、背景スクロールが正常に復元される
- [ ] プレイヤー背景が完全に不透明になっている
- [ ] モバイル・デスクトップ両方で正常に動作する
- [ ] 既存のプレイヤー機能に影響がない
- [ ] テストが全てパス

## 🧪 テスト項目

- [ ] フルスクリーンプレイヤーを開いて背景スクロールが無効化されることを確認
- [ ] プレイヤーを閉じて背景スクロールが復元されることを確認
- [ ] モバイルデバイスでスワイプ操作時の挙動を確認
- [ ] プレイヤー背景が完全に不透明であることを確認
- [ ] プレイヤー内のコンテンツが正常に表示されることを確認
- [ ] 複数ブラウザでの動作確認(Chrome, Safari, Firefox)
- [ ] レスポンシブデザインの確認(モバイル/タブレット/デスクトップ)

## 📝 メモ

- iOS Safariではbodyの固定化に特別な対応が必要な場合がある
- タッチイベントのpreventDefaultも検討する必要がある可能性
- 既存のスクロール復元処理との競合に注意
- プレイヤーが予期せず閉じた場合のクリーンアップ処理を忘れずに実装

チケット作成日: 2025-10-28

## 🔗 関連

- 関連Issue: -
- 関連PR: -
- 参考資料: -
