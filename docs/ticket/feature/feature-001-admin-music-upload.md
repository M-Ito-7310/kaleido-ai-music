# Feature #001: 管理者ページへの音楽アップロード機能の追加

**ステータス**: 🔴 未着手
**優先度**: High
**担当**: 未割当
**作成日**: 2025-10-26
**完了日**: -

## ✨ 機能概要

管理者専用ページに音楽アップロード機能を実装し、一般ユーザーからは隠蔽されたセキュアな音楽管理環境を提供する。

## 🎯 目的・背景

- 現在、Webアプリとティング AI音楽のデモとしてリリースしている
- 一般ユーザーのアップロード機能は非公開とするが、管理者は音楽をアップロードできる必要がある
- 管理者専用の音楽管理機能を提供し、コンテンツの品質管理を実現する
- セキュアなアクセス制御により、不正なアップロードを防止する

## 📋 主要機能

1. **管理者認証・アクセス制御**
   - 管理者のみがアクセスできるページの実装
   - 認証システムの導入（セッション管理、トークン認証など）
   - 一般ユーザーからのアクセスをブロック

2. **音楽アップロード機能**
   - 既存のアップロードフォーム機能を管理者ページに移植
   - ファイルアップロード（音楽ファイル、カバー画像）
   - メタデータ入力（タイトル、アーティスト、ジャンル等）
   - アップロードプレビュー・確認機能

3. **音楽管理機能**
   - アップロード済み音楽の一覧表示
   - 音楽情報の編集・削除機能（オプション）
   - 公開/非公開の切り替え（オプション）

## 🔧 技術仕様

### データ構造
- 認証テーブル/モデル: 管理者ユーザー情報の管理
- 既存の音楽データモデルを活用

### API設計
- `POST /api/admin/music/upload` - 音楽アップロード（管理者専用）
- `GET /api/admin/music` - 音楽一覧取得（管理者専用）
- `PUT /api/admin/music/:id` - 音楽情報更新（管理者専用、オプション）
- `DELETE /api/admin/music/:id` - 音楽削除（管理者専用、オプション）
- 認証ミドルウェアによるアクセス制御

### UI/UXデザイン
- 新しいページ: `/admin` または `/admin/music/upload`
- 認証ページ: `/admin/login`（必要に応じて）
- 既存のアップロードフォームUIを管理者ページに適用
- 管理者専用ナビゲーションメニュー

### 依存関係
- 認証ライブラリ: NextAuth.js、Auth0、またはカスタム認証
- 既存のファイルアップロード機能を再利用
- 環境変数: 管理者認証情報の管理

## ✅ 実装タスク

### 認証システム
- [ ] 認証方式の選定（NextAuth.js推奨）
- [ ] 管理者ログインページの実装
- [ ] セッション管理の実装
- [ ] 認証ミドルウェアの実装

### バックエンド
- [ ] 管理者専用API Routesの作成
- [ ] アクセス制御ミドルウェアの実装
- [ ] 既存アップロードAPIの管理者版への移植
- [ ] エラーハンドリング

### フロントエンド
- [ ] 管理者ページレイアウトの作成
- [ ] アップロードフォームコンポーネントの移植
- [ ] 管理者ナビゲーションの実装
- [ ] 音楽管理UIの実装（一覧、編集、削除）

### セキュリティ
- [ ] CSRF対策
- [ ] 認証トークンの安全な管理
- [ ] 環境変数による認証情報の保護
- [ ] レート制限の実装（オプション）

### テスト
- [ ] 認証機能のテスト
- [ ] アップロード機能のテスト
- [ ] アクセス制御のテスト
- [ ] E2Eテスト

## 📦 成果物

- [ ] `/app/admin/login/page.tsx` - 管理者ログインページ
- [ ] `/app/admin/music/upload/page.tsx` - 音楽アップロードページ
- [ ] `/app/api/admin/music/route.ts` - 管理者専用音楽API
- [ ] `/middleware.ts` - 認証ミドルウェア（または既存の拡張）
- [ ] 認証設定ファイル（NextAuth.jsの場合: `/app/api/auth/[...nextauth]/route.ts`）

## 🎯 完了条件

- [ ] 管理者のみが音楽アップロードページにアクセスできる
- [ ] 一般ユーザーは管理者ページにアクセスできない（リダイレクトまたは403）
- [ ] 音楽のアップロードが正常に動作する
- [ ] アップロードされた音楽が一般ユーザー向けページで正常に表示される
- [ ] テストが全てパス
- [ ] セキュリティ要件を満たしている

## 🧪 テスト計画

### 単体テスト
- [ ] 認証ミドルウェアのテスト
- [ ] API認証チェックのテスト
- [ ] アップロード処理のテスト

### 統合テスト
- [ ] ログイン→アップロード→一覧表示の一連のフロー
- [ ] 未認証ユーザーのアクセス拒否
- [ ] セッション期限切れ時の動作

### E2Eテスト
- [ ] 管理者ログインシナリオ
- [ ] 音楽アップロードシナリオ
- [ ] アクセス制御シナリオ（一般ユーザーのブロック）

### ブラウザテスト
- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Mobile Safari (iOS)
- [ ] Chrome Mobile (Android)

## 📝 メモ

- 初期実装では、シンプルな環境変数ベースの認証（パスワード固定）でも可
- 将来的にはより堅牢な認証システム（OAuth、2FA等）への拡張を検討
- 既存のアップロードフォームコンポーネント（enhancement-004で簡素化）を最大限再利用
- 関連チケット: enhancement-005（一般ユーザー向けアップロード機能の非公開化）

## 🔗 関連

- 関連チケット: enhancement-005 (一般ユーザー向け音楽アップロード機能の非公開化)
- 関連Issue: -
- 関連PR: -
- 参考資料:
  - NextAuth.js Documentation: https://next-auth.js.org/
  - Next.js Middleware: https://nextjs.org/docs/app/building-your-application/routing/middleware
