# Feature #004: 管理者ページにアップロード済み動画の編集機能を実装

**ステータス**: 🔴 未着手
**優先度**: Medium
**担当**: 未割当
**作成日**: 2025-10-27
**完了日**: -

## ✨ 機能概要

管理者ページにおいて、既にアップロード済みの動画を編集できる専用ページを実装する。タイトル、説明、サムネイル、タグ、ムード、共有リンクの編集が可能で、動画の削除機能も含む。

## 🎯 目的・背景

現状、動画をアップロードした後に情報を修正する手段がないため、誤った情報や更新が必要な情報を変更できない。管理者が動画情報を柔軟に管理できるようにすることで、コンテンツの品質を維持し、ユーザー体験を向上させる。

## 📋 主要機能

1. **動画編集専用ページ** - 既存動画の情報を編集するための専用UI
2. **編集可能項目** - タイトル、説明、サムネイル、タグ、ムード、共有リンク
3. **動画削除機能** - 不要な動画を削除できる機能
4. **バリデーション** - 各フィールドの適切な検証
5. **リアルタイムプレビュー** - 編集内容の確認

## 🔧 技術仕様

### データ構造
- 既存テーブル: `music` テーブル (Supabase)
- 編集対象フィールド:
  - `title` (文字列)
  - `description` (テキスト)
  - `thumbnail_url` (URL)
  - `tags` (配列)
  - `mood` (文字列)
  - `share_link` (URL)

### API設計
- **編集API**: `PATCH /api/admin/music/[id]`
  - リクエスト: フォームデータまたはJSON
  - レスポンス: 更新された動画情報
- **削除API**: `DELETE /api/admin/music/[id]`
  - リクエスト: 動画ID
  - レスポンス: 削除成功/失敗

### UI/UXデザイン
- **新しいページ**: `/admin/music/[id]/edit`
- **主要コンポーネント**:
  - 編集フォーム（各フィールドの入力欄）
  - サムネイルアップロード機能
  - タグ入力UI（複数選択/追加可能）
  - ムード選択ドロップダウン
  - 保存ボタン
  - キャンセルボタン
  - 削除ボタン（確認モーダル付き）
- **ユーザーフロー**:
  1. 管理者ページの動画一覧から「編集」ボタンをクリック
  2. 編集ページへ遷移、現在の情報が入力済みで表示
  3. 各フィールドを編集
  4. 「保存」で更新、「削除」で削除確認モーダル表示

### 依存関係
- 既存パッケージ: React Hook Form（フォーム管理）
- 既存パッケージ: Supabase Client（データベース操作）
- 既存機能への影響: 管理者ページの動画一覧に「編集」ボタンを追加

## ✅ 実装タスク

### バックエンド
- [ ] 動画更新API (`PATCH /api/admin/music/[id]`) 実装
- [ ] 動画削除API (`DELETE /api/admin/music/[id]`) 実装
- [ ] バリデーション実装（各フィールドの検証）
- [ ] 権限チェック（管理者のみアクセス可能）
- [ ] エラーハンドリング

### フロントエンド
- [ ] 編集ページコンポーネント (`/admin/music/[id]/edit`) 作成
- [ ] 編集フォームUI実装
- [ ] サムネイルアップロード機能実装
- [ ] タグ入力UI実装
- [ ] ムード選択UI実装
- [ ] 削除確認モーダル実装
- [ ] API連携（更新・削除）
- [ ] ローディング状態の表示
- [ ] 成功/エラートースト通知
- [ ] 管理者ページ一覧に「編集」ボタン追加

### テスト
- [ ] API単体テスト（更新・削除）
- [ ] フォームバリデーションテスト
- [ ] 統合テスト（編集フロー全体）
- [ ] 権限テスト（非管理者のアクセス拒否）

## 📦 成果物

- [ ] `/app/admin/music/[id]/edit/page.tsx` - 編集ページ
- [ ] `/app/api/admin/music/[id]/route.ts` - 更新・削除API
- [ ] `/components/admin/MusicEditForm.tsx` - 編集フォームコンポーネント
- [ ] `/components/admin/DeleteConfirmModal.tsx` - 削除確認モーダル
- [ ] `/app/admin/page.tsx` - 一覧ページに編集ボタン追加

## 🎯 完了条件

- [ ] すべての実装タスクが完了
- [ ] 動画情報の編集が正常に動作
- [ ] 動画削除が正常に動作
- [ ] サムネイルアップロードが正常に動作
- [ ] バリデーションが適切に機能
- [ ] 管理者以外はアクセス不可
- [ ] テストが全てパス
- [ ] コードレビュー完了
- [ ] 本番環境で動作確認

## 🧪 テスト計画

### 単体テスト
- [ ] 動画更新APIのテスト（正常系）
- [ ] 動画更新APIのテスト（異常系: 存在しないID）
- [ ] 動画削除APIのテスト（正常系）
- [ ] 動画削除APIのテスト（異常系: 権限なし）
- [ ] フォームバリデーションのテスト

### 統合テスト
- [ ] 編集ページの表示テスト
- [ ] フォーム送信から保存までのフロー
- [ ] 削除ボタンから削除完了までのフロー
- [ ] エラーハンドリングのテスト

### E2Eテスト
- [ ] 管理者が動画一覧から編集ページへ遷移
- [ ] 動画情報を編集して保存
- [ ] サムネイルを変更して保存
- [ ] タグとムードを変更して保存
- [ ] 削除ボタンから動画を削除
- [ ] 非管理者が編集ページにアクセスできないことを確認

### ブラウザテスト
- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Mobile Safari (iOS)
- [ ] Chrome Mobile (Android)

## 📝 メモ

- サムネイルアップロードはSupabase Storageを使用
- 削除時は論理削除ではなく物理削除を行う（要確認）
- 編集中に他の管理者が同時編集する可能性は低いため、楽観的ロックは不要
- タグとムードは既存の選択肢から選べるようにし、新規追加も可能にする

## 🔗 関連

- 関連Issue: -
- 関連PR: -
- 参考資料: -
- デザインモックアップ: -
