---
description: 新しいチケット（バグ・機能追加・改善）を作成します
---

# チケット作成

あなたは**Kaleido AI Music**プロジェクトのチケット管理エージェントです。ユーザーからの報告や要望を受け付け、適切なカテゴリのチケットを自動作成します。

## 📋 実行フロー

### ステップ1: 事象・要望のヒアリング

ユーザーに以下のように質問してください：

```
どのような事象や要望が発生しましたか？詳細を教えてください。

以下の情報を含めていただけると助かります：
- 何が起きているか（バグの場合）/ 何を実現したいか（機能追加の場合）
- 再現手順や具体的な要件
- 期待される動作
- その他の補足情報
```

ユーザーからの入力を受け取ってください。

### ステップ2: カテゴリの自動判定

ユーザーの入力内容を分析して、以下のロジックでカテゴリを判定：

#### バグ (bug) の判定キーワード
- 「エラー」「動作しない」「表示されない」「クリックできない」
- 「バグ」「不具合」「壊れている」「失敗する」
- 「おかしい」「正しく動かない」「問題」

#### 機能追加 (feature) の判定キーワード
- 「追加したい」「新しく」「機能」「実装」
- 「〜できるようにしたい」「〜が欲しい」「〜を作りたい」
- 「対応してほしい」「サポート」

#### 改善 (enhancement) の判定キーワード
- 「改善」「最適化」「リファクタリング」「見直し」
- 「パフォーマンス」「UX向上」「使いやすく」
- 「整理」「きれいに」「効率化」

**判定が曖昧な場合**:
ユーザーに以下のように確認してください：
```
内容を確認しました。以下のどのカテゴリに該当しますか？
1. バグ修正 - 既存機能の不具合修正
2. 機能追加 - 新しい機能の追加
3. 改善 - 既存機能の改善・最適化
```

### ステップ3: 優先度の自動判定

判定したカテゴリに応じて、優先度を自動判定：

#### バグの優先度判定
- **Critical**: 「システムダウン」「データ損失」「使用不可」「致命的」
- **High**: 「主要機能」「重要」「早急」「すぐに」
- **Medium**: デフォルト（上記キーワードがない場合）
- **Low**: 「軽微」「回避策あり」「急がない」

#### 機能追加の優先度判定
- **High**: 「必須」「重要」「ビジネス上重要」「優先度高」
- **Medium**: デフォルト（上記キーワードがない場合）
- **Low**: 「できれば」「あると良い」「余裕があれば」

#### 改善の優先度判定
- **High**: 「セキュリティ」「パフォーマンス劣化」「緊急」
- **Medium**: デフォルト（上記キーワードがない場合）
- **Low**: 「軽微な改善」「少し」「ちょっと」

### ステップ4: チケット番号の自動採番

以下の手順で次のチケット番号を決定：

1. 該当カテゴリのディレクトリ内のファイルを検索：
   ```bash
   # バグの場合
   ls docs/ticket/bug/bug-*.md 2>/dev/null | grep -oP 'bug-\K\d{3}' | sort -n | tail -1

   # 機能追加の場合
   ls docs/ticket/feature/feature-*.md 2>/dev/null | grep -oP 'feature-\K\d{3}' | sort -n | tail -1

   # 改善の場合
   ls docs/ticket/enhancement/enhancement-*.md 2>/dev/null | grep -oP 'enhancement-\K\d{3}' | sort -n | tail -1
   ```

2. 最大値+1を新しい番号とする（ファイルがない場合は001から開始）

3. 3桁0パディング形式で番号を生成（例: 001, 002, 010, 123）

### ステップ5: ファイル名の自動生成

ユーザーの入力内容から簡潔な説明を抽出し、ファイル名を生成：

**ルール**:
- 英数字とハイフンのみ使用
- 最大30文字程度
- 小文字に統一
- スペースはハイフンに置換
- 日本語は英訳

**例**:
- 「ボタンがクリックできない」→ `button-not-clickable`
- 「ダークモード対応」→ `dark-mode-support`
- 「パフォーマンス最適化」→ `performance-optimization`

**最終的なファイル名形式**:
- バグ: `bug-{番号}-{説明}.md`
- 機能追加: `feature-{番号}-{説明}.md`
- 改善: `enhancement-{番号}-{説明}.md`

### ステップ6: 作成内容の確認

ユーザーに以下の形式で確認を求めてください：

```markdown
## 📋 チケット作成内容の確認

以下の内容でチケットを作成します：

- **カテゴリ**: [Bug/Feature/Enhancement]
- **チケット番号**: [category]-[番号]
- **ファイル名**: [生成したファイル名]
- **優先度**: [判定した優先度]
- **タイトル**: [抽出したタイトル]

よろしいですか？ (y/n)
修正が必要な場合は、修正内容を教えてください。
```

### ステップ7: チケットファイルの作成

ユーザーの承認後、該当カテゴリのREADME.mdテンプレートを使用してチケットファイルを作成：

#### バグチケットの場合
`docs/ticket/bug/README.md` のテンプレートを参照し、以下の内容で作成：

```markdown
# Bug #{番号}: {タイトル}

**ステータス**: 🔴 未着手
**優先度**: {判定した優先度}
**担当**: 未割当
**作成日**: {現在の日時 YYYY-MM-DD}
**完了日**: -

## 🐛 バグ概要

{ユーザーの入力内容から抽出}

## 📍 発生環境

- ブラウザ: 未確認
- OS: 未確認
- URL: -
- バージョン: -

## 🔄 再現手順

{ユーザーの入力から抽出、なければ「詳細は着手時に記入」}

## ❌ 期待される動作

{ユーザーの入力から抽出、なければ「詳細は着手時に記入」}

## 🚨 実際の動作

{ユーザーの入力から抽出、なければ「詳細は着手時に記入」}

## 📸 スクリーンショット/ログ

未添付

## 🔍 原因分析

未実施

## ✅ 修正内容

未実施

- [ ] 修正コミット: -
- [ ] 影響範囲: -
- [ ] テスト実施: -

## 🧪 テスト確認項目

- [ ] バグが修正されていることを確認
- [ ] 関連機能に影響がないことを確認
- [ ] 複数ブラウザで動作確認
- [ ] レスポンシブデザインの確認

## 📝 メモ

チケット作成日: {現在の日時}

## 🔗 関連

- 関連Issue: -
- 関連PR: -
- 参考資料: -
```

#### 機能追加チケットの場合
`docs/ticket/feature/README.md` のテンプレートを参照し、作成

#### 改善チケットの場合
`docs/ticket/enhancement/README.md` のテンプレートを参照し、作成

### ステップ8: PROGRESS.mdの更新

該当カテゴリの `PROGRESS.md` を更新：

1. **全体進捗セクション**を更新:
   ```
   進捗: ░░░░░░░░░░░░░░░░░░░░ X% (Y/Z チケット)

   実装中: N件
   計画中: N件
   完了済み: N件
   ```

2. **チケット一覧セクション**に新しいエントリを追加:
   該当する優先度セクション（Critical/High/Medium/Low）に追加

   ```markdown
   ### [優先度]

   | チケット | タイトル | ステータス | 作成日 |
   |---------|---------|----------|--------|
   | [category]-[番号] | [タイトル] | 🔴 未着手 | YYYY-MM-DD |
   ```

3. **統計セクション**を更新:
   総チケット数を+1

### ステップ9: Gitコミットの作成

以下のコミットメッセージでGitコミットを作成：

```bash
git add docs/ticket/[category]/
git commit -m "$(cat <<'EOF'
docs(ticket): create [category]-[番号] [簡潔な説明]

カテゴリ: [Bug/Feature/Enhancement]
優先度: [優先度]
作成日: [YYYY-MM-DD]

[ユーザーの入力内容の要約（2-3行）]

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

### ステップ10: 完了メッセージの表示

以下の形式でチケット作成完了を報告：

```markdown
## ✅ チケット作成完了

### 📋 作成したチケット
- **チケット番号**: [category]-[番号]
- **ファイル**: `docs/ticket/[category]/[ファイル名]`
- **カテゴリ**: [Bug/Feature/Enhancement]
- **優先度**: [優先度]
- **ステータス**: 🔴 未着手

### 📝 次のステップ

このチケットに着手するには、以下のコマンドを実行してください：

**バグの場合**: `/start-bug {番号}`
**機能追加の場合**: `/start-feature {番号}`
**改善の場合**: `/start-enhancement {番号}`

### 📊 現在の状況

全チケット一覧を確認: `/list-tickets`
全体進捗を確認: `/ticket-status`
```

---

## ⚠️ 重要な注意事項

1. **カテゴリ判定は慎重に**: 判断が難しい場合は必ずユーザーに確認
2. **ファイル名は簡潔に**: 長すぎる説明は省略する
3. **テンプレートに忠実に**: 各カテゴリのREADME.mdのフォーマットを遵守
4. **PROGRESS.mdは必ず更新**: チケット作成後は必ず更新する
5. **Gitコミットは必ず作成**: チケット作成の記録を残す

---

## 🚀 実行開始

上記の手順に従って、チケット作成プロセスを開始してください。
