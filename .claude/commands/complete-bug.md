---
description: バグ修正チケットを完了します
---

# バグチケット完了

あなたは**Kaleido AI Music**プロジェクトのチケット管理エージェントです。指定されたバグチケットの完了処理を実行します。

## 📋 実行フロー

### ステップ1: チケット番号の取得と検証

チケット番号: **{{ticket_number}}**

チケット番号を3桁0パディング形式に変換: `{{ticket_number_padded}}` (例: 1 → 001, 23 → 023)

### ステップ2: チケットファイルの読み込み

以下のファイルを読み込んでください：

1. **チケットファイル**:
   - `docs/ticket/bug/bug-{{ticket_number_padded}}-*.md` をGlobパターンで検索して読み込み
   - ファイルが存在しない場合はエラーメッセージを表示して終了

2. **現在のステータス確認**:
   - ステータスが「進行中」であることを確認
   - 「未着手」の場合は警告を表示

### ステップ3: 完了条件の確認（厳格チェック）

チケットファイルの以下のセクションを確認：

1. **localhost動作確認済み**かどうかを確認
   - チケットのメモセクションに「localhost動作確認済み」の記録があるか
   - または、ユーザーに直接「localhostで動作確認済みですか？」と質問する

2. **テスト確認項目**がすべて完了しているか確認
3. **修正内容**が記録されているか確認
4. **原因分析**が記録されているか確認

**localhost動作確認が未完了の場合**:
```markdown
⚠️ エラー: localhost での動作確認が必要です

このチケットを完了する前に、以下を実施してください:

1. 開発サーバーを起動: `npm run dev`
2. ブラウザで動作を確認
3. 確認後、「動作確認OK」と返信してください

動作確認なしではチケットを完了できません。
```

**その他の項目が完了していない場合**:
```markdown
⚠️ 警告: 以下の項目が未完了です

- [ ] [未完了項目1]
- [ ] [未完了項目2]

これらの項目を完了してから、再度 `/complete-bug {{ticket_number}}` を実行してください。
```

**重要**: localhost動作確認が完了していない場合は、この時点で処理を中断してください。ユーザーに確認を求め、承認されたら次に進む。

### ステップ4: 実績時間の計算

チケットファイルから開始日時を取得し、実績時間を計算：

```
開始日時: [チケットから取得]
完了日時: [現在の日時]
実績時間: [差分を分単位で計算]
```

### ステップ5: チケットファイルの更新（完了）

チケットファイル (`docs/ticket/bug/bug-{{ticket_number_padded}}-*.md`) を以下のように更新：

#### 5-1. ステータス・日時の更新
```markdown
**ステータス**: 🟢 完了
**完了日時**: [現在の日時 YYYY-MM-DD HH:MM]
**実績時間**: [計算した実績時間] (例: 45分)
```

#### 5-2. テスト確認項目の更新
`## 🧪 テスト確認項目` セクションの各項目を `- [ ]` → `- [x]` に更新

#### 5-3. メモセクションへの完了記録
`## 📝 メモ` セクションに以下を追記：

```markdown
### 完了記録
完了日時: [現在の日時]
実績時間: [実績時間]
Git commit: [後で記録]

#### 最終確認
- [x] バグが完全に修正されている
- [x] 関連機能に影響がない
- [x] テストがすべてパス
- [x] TypeScriptエラーなし
```

**必ず実際にファイルを編集してチケットを更新してください。**

### ステップ6: PROGRESS.md更新（完了）

`docs/ticket/bug/PROGRESS.md` を更新：

#### 6-1. 全体進捗バーの更新
```
進捗: ████████████████░░░░ X% (Y/Z バグ)

バグ修正中: N件 (-1)
未対応バグ: N件
完了済み: N件 (+1)
```

#### 6-2. 現在対応中のバグセクションから削除
該当するバグエントリを削除

#### 6-3. 完了済みバグセクションに追加
```markdown
## ✅ 完了済みバグ

### Bug #{{ticket_number_padded}}: [タイトル] ✅
- 優先度: [優先度]
- 完了日: [現在の日時]
- 実績時間: [実績時間]
- 修正内容: [簡潔な説明]
```

#### 6-4. バグ一覧セクションの更新
該当チケットのステータスを 🟡 進行中 → 🟢 完了 に更新

#### 6-5. 統計セクションの更新
- 完了数を+1
- 対応中を-1
- 平均修正時間を再計算

**必ず実際にファイルを編集してPROGRESS.mdを更新してください。**

### ステップ7: Gitコミットの作成

以下のコミットメッセージでGitコミットを作成：

```bash
git add docs/ticket/bug/
git commit -m "$(cat <<'EOF'
fix([scope]): [バグの簡潔な説明]

Closes: bug-{{ticket_number_padded}}

修正内容:
- [修正内容1]
- [修正内容2]
- [修正内容3]

テスト:
- [テスト項目1] ✅
- [テスト項目2] ✅

実績時間: [実績時間]

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

**scopeの決定**:
- UIバグ: ui
- APIバグ: api
- データベースバグ: db
- ビルドバグ: build
- その他: fix

### ステップ8: チケットファイルにコミット情報を追記

Gitコミット作成後、コミットハッシュを取得してチケットファイルに追記：

```bash
# コミットハッシュを取得
git log -1 --format='%H'
```

チケットファイルの「修正内容」セクションを更新：
```markdown
- [x] 修正コミット: [コミットハッシュ]
```

メモセクションのGit commit欄を更新：
```markdown
Git commit: [コミットハッシュ]
```

**必ず実際にファイルを編集してチケットファイルを更新してください。**

### ステップ9: チケット更新を再コミット

チケットファイルにコミット情報を追記した変更を再度コミット：

```bash
git add docs/ticket/bug/bug-{{ticket_number_padded}}-*.md
git commit -m "$(cat <<'EOF'
docs(ticket): bug-{{ticket_number_padded}}チケットにコミット情報を記録

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

### ステップ10: 完了レポートの表示

以下の形式でバグチケット完了を報告：

```markdown
## ✅ Bug #{{ticket_number_padded}} 完了

### 📋 バグ修正サマリー
- **チケット**: bug-{{ticket_number_padded}}
- **タイトル**: [タイトル]
- **優先度**: [優先度]
- **実績時間**: [実績時間]
- **完了日時**: [現在の日時]

### 🔧 修正内容
- [修正内容1]
- [修正内容2]
- [修正内容3]

### 📦 変更ファイル
- [ファイル1]
- [ファイル2]

### ✅ テスト結果
- [x] バグが修正されていることを確認
- [x] 関連機能に影響がないことを確認
- [x] TypeScriptエラーなし
- [x] ビルド成功

### 📊 Git情報
- **コミット**: [コミットハッシュ]
- **コミットメッセージ**: fix([scope]): [説明]

### 🎉 完了

Bug #{{ticket_number_padded}} の修正が完了しました！

---

### 📝 次のアクション

他のチケットを確認:
- `/list-tickets` - チケット一覧を表示
- `/ticket-status` - 全体進捗を確認

新しいチケットに着手:
- `/start-bug [番号]` - 次のバグ修正を開始
```

---

## ⚠️ 重要な注意事項

1. **すべての完了条件を満たしてから完了**してください
2. **チケットファイルとPROGRESS.mdは必ず更新**してください
3. **実績時間は正確に記録**してください
4. **Gitコミットは必ず作成**してください
5. **コミットメッセージは分かりやすく**記述してください

---

## 🚀 実行開始

上記の手順に従って、Bug #{{ticket_number}} の完了処理を開始してください。

**重要**: ステップ9のチケット更新の再コミットを必ず実行してください。
