---
description: 機能追加チケットを完了します
---

# 機能追加チケット完了

あなたは**Kaleido AI Music**プロジェクトのチケット管理エージェントです。指定された機能追加チケットの完了処理を実行します。

## 📋 実行フロー

### ステップ1: チケット番号の取得と検証

チケット番号: **{{ticket_number}}**

チケット番号を3桁0パディング形式に変換: `{{ticket_number_padded}}` (例: 1 → 001, 23 → 023)

### ステップ2: チケットファイルの読み込み

以下のファイルを読み込んでください：

1. **チケットファイル**:
   - `docs/ticket/feature/feature-{{ticket_number_padded}}-*.md` をGlobパターンで検索して読み込み
   - ファイルが存在しない場合はエラーメッセージを表示して終了

2. **現在のステータス確認**:
   - ステータスが「進行中」であることを確認
   - 「未着手」の場合は警告を表示

### ステップ3: 完了条件の確認（厳格チェック）

チケットファイルの以下のセクションを確認：

1. **localhost動作確認済み**かどうかを確認
   - チケットのメモセクションに「localhost動作確認済み」の記録があるか
   - または、ユーザーに直接「localhostで動作確認済みですか？」と質問する

2. **実装タスク**がすべて完了しているか確認
3. **成果物**がすべて作成されているか確認
4. **テスト計画**のすべてのテストが完了しているか確認
5. **完了条件**がすべて満たされているか確認

**localhost動作確認が未完了の場合**:
```markdown
⚠️ エラー: localhost での動作確認が必要です

このチケットを完了する前に、以下を実施してください:

1. 開発サーバーを起動: `npm run dev`
2. ブラウザで新機能を確認
3. 確認後、「動作確認OK」と返信してください

動作確認なしではチケットを完了できません。
```

**その他の項目が完了していない場合**:
```markdown
⚠️ 警告: 以下の項目が未完了です

- [ ] [未完了項目1]
- [ ] [未完了項目2]

これらの項目を完了してから、再度 `/complete-feature {{ticket_number}}` を実行してください。
```

**重要**: localhost動作確認が完了していない場合は、この時点で処理を中断してください。ユーザーに確認を求め、承認されたら次に進む。

### ステップ4: 実績時間の計算

チケットファイルから開始日時を取得し、実績時間を計算：

```
開始日時: [チケットから取得]
完了日時: [現在の日時]
実績時間: [差分を時間・分単位で計算]
```

### ステップ5: チケットファイルの更新（完了）

チケットファイル (`docs/ticket/feature/feature-{{ticket_number_padded}}-*.md`) を以下のように更新：

#### 5-1. ステータス・日時の更新
```markdown
**ステータス**: 🟢 完了
**完了日時**: [現在の日時 YYYY-MM-DD HH:MM]
**実績時間**: [計算した実績時間] (例: 2時間30分)
```

#### 5-2. 実装タスクの更新
`## ✅ 実装タスク` セクションの各項目を `- [ ]` → `- [x]` に更新

#### 5-3. 成果物の更新
`## 📦 成果物` セクションの各項目を `- [ ]` → `- [x]` に更新

#### 5-4. テスト計画の更新
すべてのテスト項目（単体/統合/E2E）を `- [ ]` → `- [x]` に更新

#### 5-5. 完了条件の更新
`## 📊 完了条件` セクションの各項目を `- [ ]` → `- [x]` に更新

#### 5-6. メモセクションへの完了記録
`## 📝 メモ` セクションに以下を追記：

```markdown
### 完了記録
完了日時: [現在の日時]
実績時間: [実績時間]
見積時間: [チケットの見積時間]
Git commit: [後で記録]

#### 最終確認
- [x] すべての機能が実装されている
- [x] すべてのテストがパス
- [x] TypeScriptエラーなし
- [x] ドキュメント更新済み
- [x] デプロイ可能な状態
```

**必ず実際にファイルを編集してチケットを更新してください。**

### ステップ6: PROGRESS.md更新（完了）

`docs/ticket/feature/PROGRESS.md` を更新：

#### 6-1. 全体進捗バーの更新
```
進捗: ████████████████░░░░ X% (Y/Z 機能)

実装中: N件 (-1)
計画中: N件
完了済み: N件 (+1)
```

#### 6-2. 現在実装中の機能セクションから削除
該当する機能エントリを削除

#### 6-3. 完了済み機能セクションに追加
```markdown
## ✅ 完了済み機能

### Feature #{{ticket_number_padded}}: [タイトル] ✅
- 優先度: [優先度]
- 完了日: [現在の日時]
- 実績時間: [実績時間]
- 実装内容: [簡潔な説明]
```

#### 6-4. 機能一覧セクションの更新
該当チケットのステータスを 🟡 進行中 → 🟢 完了 に更新

#### 6-5. 統計セクションの更新
- 完了数を+1
- 実装中を-1
- 平均実装時間を再計算

**必ず実際にファイルを編集してPROGRESS.mdを更新してください。**

### ステップ7: Gitコミットの作成

以下のコミットメッセージでGitコミットを作成：

```bash
git add .
git commit -m "$(cat <<'EOF'
feat([scope]): [機能の簡潔な説明]

Closes: feature-{{ticket_number_padded}}

実装内容:
- [実装内容1]
- [実装内容2]
- [実装内容3]

成果物:
- [ファイル1]
- [ファイル2]
- [ファイル3]

テスト:
- [テスト項目1] ✅
- [テスト項目2] ✅

実績時間: [実績時間]

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

**scopeの決定**:
- UI機能: ui
- API機能: api
- データベース機能: db
- 音楽機能: music
- 検索機能: search
- その他: feature

### ステップ8: チケットファイルにコミット情報を追記

Gitコミット作成後、コミットハッシュを取得してチケットファイルに追記：

```bash
# コミットハッシュを取得
git log -1 --format='%H'
```

メモセクションのGit commit欄を更新：
```markdown
Git commit: [コミットハッシュ]
```

**必ず実際にファイルを編集してチケットファイルを更新してください。**

### ステップ9: チケット更新を再コミット

チケットファイルにコミット情報を追記した変更を再度コミット：

```bash
git add docs/ticket/feature/feature-{{ticket_number_padded}}-*.md
git commit -m "$(cat <<'EOF'
docs(ticket): feature-{{ticket_number_padded}}チケットにコミット情報を記録

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

### ステップ10: 完了レポートの表示

以下の形式で機能追加チケット完了を報告：

```markdown
## ✅ Feature #{{ticket_number_padded}} 完了

### 📋 機能実装サマリー
- **チケット**: feature-{{ticket_number_padded}}
- **タイトル**: [タイトル]
- **優先度**: [優先度]
- **見積時間**: [見積時間]
- **実績時間**: [実績時間]
- **完了日時**: [現在の日時]

### 🎯 実装した機能
- [機能1]
- [機能2]
- [機能3]

### 📦 作成したファイル
- [ファイル1]
- [ファイル2]
- [ファイル3]

### ✅ テスト結果
- [x] 単体テスト: すべてパス
- [x] 統合テスト: すべてパス
- [x] E2Eテスト: すべてパス
- [x] TypeScriptエラーなし
- [x] ビルド成功

### 📊 Git情報
- **コミット**: [コミットハッシュ]
- **コミットメッセージ**: feat([scope]): [説明]

### 🎉 完了

Feature #{{ticket_number_padded}} の実装が完了しました！

---

### 📝 次のアクション

他のチケットを確認:
- `/list-tickets` - チケット一覧を表示
- `/ticket-status` - 全体進捗を確認

新しいチケットに着手:
- `/start-feature [番号]` - 次の機能追加を開始
```

---

## ⚠️ 重要な注意事項

1. **すべての完了条件を満たしてから完了**してください
2. **チケットファイルとPROGRESS.mdは必ず更新**してください
3. **実績時間は正確に記録**してください
4. **Gitコミットは必ず作成**してください
5. **成果物がすべて作成されていることを確認**してください

---

## 🚀 実行開始

上記の手順に従って、Feature #{{ticket_number}} の完了処理を開始してください。

**重要**: ステップ9のチケット更新の再コミットを必ず実行してください。
