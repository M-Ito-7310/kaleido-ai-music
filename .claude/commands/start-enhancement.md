---
description: 改善チケットの実装を開始します
---

# 改善チケット実装開始

あなたは**Kaleido AI Music**プロジェクトの専属開発エージェントです。指定された改善チケットの実装を完全自動で実行します。

## 📋 実行フロー

### ステップ1: チケット番号の取得と検証

チケット番号: **{{ticket_number}}**

チケット番号を3桁0パディング形式に変換: `{{ticket_number_padded}}` (例: 1 → 001, 23 → 023)

### ステップ2: チケットファイルの読み込み

以下のファイルを読み込んでください：

1. **チケットファイル**:
   - `docs/ticket/enhancement/enhancement-{{ticket_number_padded}}-*.md` をGlobパターンで検索して読み込み
   - ファイルが存在しない場合はエラーメッセージを表示して終了

2. **チケット内容の確認**:
   - 改善概要
   - 目的・背景
   - 現状の問題点
   - 改善後の期待値
   - 改善方法
   - 実装タスク

### ステップ3: チケットステータス更新（進行中）

チケットファイル (`docs/ticket/enhancement/enhancement-{{ticket_number_padded}}-*.md`) を以下のように更新：

```markdown
**ステータス**: 🟡 進行中
**担当**: AIエージェント
**開始日時**: [現在の日時 YYYY-MM-DD HH:MM]
```

**必ず実際にファイルを編集してステータスを更新してください。**

### ステップ4: PROGRESS.md更新（進行中）

`docs/ticket/enhancement/PROGRESS.md` を更新：

1. **全体進捗セクション**を更新:
   ```
   進捗: ████████░░░░░░░░░░░░ X% (Y/Z 改善)

   実施中: N件 (+1)
   計画中: N件 (-1)
   完了済み: N件
   ```

2. **現在実施中の改善**セクションに追加:
   ```markdown
   ## 🔥 現在実施中の改善

   ### Enhancement #{{ticket_number_padded}}: [タイトル]
   - カテゴリ: [Performance/Refactoring/UX/Security/Code Quality]
   - 優先度: [優先度]
   - 開始日: [現在の日時]
   - 状態: 🟡 実施中
   ```

3. **改善一覧セクション**の該当チケットのステータスを更新:
   🔴 未着手 → 🟡 進行中

**必ず実際にファイルを編集してPROGRESS.mdを更新してください。**

### ステップ5: 現状分析と改善対象の特定

チケットに記載された現状の問題点を分析：

1. **対象ファイルの読み込み**:
   - チケットに記載された変更対象ファイルを読み込み
   - 関連ファイルも必要に応じて読み込み

2. **現状の問題点の確認**:
   - パフォーマンスボトルネックの特定（Performance改善の場合）
   - コードの複雑性や重複の確認（Refactoring改善の場合）
   - ユーザビリティ課題の確認（UX改善の場合）
   - セキュリティリスクの確認（Security改善の場合）
   - コード品質の問題点の確認（Code Quality改善の場合）

3. **ビフォー測定**（該当する場合）:
   - パフォーマンス指標（速度、メモリ使用量、バンドルサイズなど）
   - コードメトリクス（行数、複雑度など）

### ステップ6: 改善計画の提案

改善方法を確認し、実装計画を提案：

```markdown
## 🔧 改善計画

### 現状の問題点
[チケットから抽出した問題点]

### 改善方法
[選択したアプローチとその理由]

### 実装する内容
1. [タスク1の詳細]
2. [タスク2の詳細]
3. [タスク3の詳細]

### 変更対象ファイル
- [ファイルパス1] - [変更内容]
- [ファイルパス2] - [変更内容]
- [ファイルパス3] - [変更内容]

### リスクと対策
- リスク1: [リスク] → 対策: [対策]
- リスク2: [リスク] → 対策: [対策]

### 期待される効果
- [効果1]
- [効果2]

### 所要時間見積もり
約 [X] 時間

---

この計画で改善を進めてよろしいですか？
変更が必要な場合は、お知らせください。
```

ユーザーの承認を待ってから次に進んでください。

### ステップ7: 改善実装

承認後、実装タスクに従って順次改善：

#### 7-1. Performance改善の場合

- React.memoの追加
- useMemoやuseCallbackの活用
- 不要な再レンダリングの削減
- コード分割の実施
- 画像最適化
- バンドルサイズの削減

#### 7-2. Refactoring改善の場合

- 共通ロジックの抽出
- 重複コードの削除
- 関数の分割（単一責任原則）
- 型定義の整理
- ファイル構成の整理
- 命名の改善

#### 7-3. UX改善の場合

- ローディング状態の改善
- エラーメッセージの改善
- アニメーションの追加
- レスポンシブデザインの改善
- アクセシビリティの向上
- ツールチップの追加

#### 7-4. Security改善の場合

- XSS対策の強化
- CSP（Content Security Policy）の設定
- 入力バリデーションの強化
- 依存パッケージの更新
- 環境変数の適切な管理
- 認証・認可の強化

#### 7-5. Code Quality改善の場合

- ESLintルールの追加
- TypeScript strict modeの有効化
- エラーハンドリングの改善
- コメントの追加
- ドキュメントの整備
- テストカバレッジの向上

### ステップ8: 開発サーバー起動と視覚的動作確認 ⚠️ 必須

**重要**: この段階で必ずlocalhostでの視覚的確認を行ってください。

1. **開発サーバーの起動**:
   ```bash
   npm run dev
   ```

2. **ブラウザでの動作確認を促す**:

   以下のメッセージをユーザーに表示し、確認を待機してください:

   ```markdown
   ## 🌐 動作確認が必要です

   開発サーバーを起動しました。ブラウザで以下を確認してください:

   ### チェック項目:
   - [ ] 改善前と同じ動作をすることを確認（回帰テスト）
   - [ ] 改善効果が視覚的に確認できる（該当する場合）
   - [ ] 全ページで正常に動作することを確認
   - [ ] UIが正しく表示されている
   - [ ] ボタン/インタラクションが正常に動作する
   - [ ] コンソールエラーがない
   - [ ] パフォーマンスが改善されている（Performance改善の場合）
   - [ ] レスポンシブデザインの確認（該当する場合）

   **確認完了後、「OK」または「問題あり」と返信してください。**
   ```

3. **ユーザーからの応答を待つ**:
   - 「OK」の場合: 次のステップに進む
   - 「問題あり」の場合: 問題の詳細を聞き、再度ステップ6（改善計画の提案）に戻る

4. **TypeScriptコンパイルチェック**（確認OK後）:
   ```bash
   npm run build
   ```

5. **コード品質チェック**（該当する場合）:
   ```bash
   npm run lint
   npm run type-check
   ```

6. **パフォーマンステスト**（Performance改善の場合）:
   - 改善前後のパフォーマンス測定
   - バンドルサイズの比較
   - メモリ使用量の比較

7. **ビフォー・アフター比較**:
   改善効果を数値で記録（可能な場合）

エラーがある場合は修正してから次に進んでください。

### ステップ9: チケットファイルの更新（改善内容記録）

チケットファイルに改善内容を記録：

#### 実装タスクのチェック
`## ✅ 実装タスク` セクションの各項目を `- [ ]` → `- [x]` に更新

#### 変更対象ファイルのチェック
`## 📦 変更対象ファイル` セクションの各項目を `- [ ]` → `- [x]` に更新

#### ビフォー・アフター比較の記録
```markdown
## 🧪 ビフォー・アフター比較

| 指標 | Before | After | 改善率 |
|------|--------|-------|--------|
| [指標1] | [値] | [値] | [%] |
| [指標2] | [値] | [値] | [%] |
```

#### メモセクションに記録
```markdown
## 📝 メモ

### 改善詳細
実施日: [現在の日時]
実施者: AIエージェント

#### 変更したファイル
- [ファイルパス1] - [変更内容]
- [ファイルパス2] - [変更内容]

#### 技術的な決定事項
- [決定事項1]
- [決定事項2]

#### 改善効果
- [効果1]
- [効果2]

#### 注意点
- [注意点があれば記録]
```

### ステップ10: 完了確認

改善が完了したら、ユーザーに報告：

```markdown
## ✅ 改善実装完了

### 📋 改善内容
- **チケット**: enhancement-{{ticket_number_padded}}
- **カテゴリ**: [Performance/Refactoring/UX/Security/Code Quality]
- **変更ファイル**: [ファイルリスト]
- **テスト結果**: [全テスト項目パス]

### 🎯 改善効果
- [改善効果1]
- [改善効果2]
- [改善効果3]

### 📊 パフォーマンス改善（該当する場合）
[ビフォー・アフター比較表]

### 📝 次のステップ

改善内容を確認し、問題なければ以下のコマンドでチケットを完了してください：

`/complete-enhancement {{ticket_number}}`

追加の改善や修正が必要な場合は、お知らせください。
```

---

## ⚠️ 重要な注意事項

1. **チケットファイルとPROGRESS.mdは必ず更新**してください
2. **改善前にユーザーの承認を得る**こと
3. **既存機能への影響を必ず確認**してください
4. **回帰テストは必ず実施**してください
5. **改善効果を定量的に測定**できる場合は記録する
6. **リスクを常に意識**して改善を行う

---

## 🚀 実行開始

上記の手順に従って、Enhancement #{{ticket_number}} の改善を開始してください。
