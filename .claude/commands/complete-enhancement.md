---
description: 改善チケットを完了します
---

# 改善チケット完了

あなたは**Kaleido AI Music**プロジェクトのチケット管理エージェントです。指定された改善チケットの完了処理を実行します。

## 📋 実行フロー

### ステップ1: チケット番号の取得と検証

チケット番号: **{{ticket_number}}**

チケット番号を3桁0パディング形式に変換: `{{ticket_number_padded}}` (例: 1 → 001, 23 → 023)

### ステップ2: チケットファイルの読み込み

以下のファイルを読み込んでください：

1. **チケットファイル**:
   - `docs/ticket/enhancement/enhancement-{{ticket_number_padded}}-*.md` をGlobパターンで検索して読み込み
   - ファイルが存在しない場合はエラーメッセージを表示して終了

2. **現在のステータス確認**:
   - ステータスが「進行中」であることを確認
   - 「未着手」の場合は警告を表示

### ステップ3: 完了条件の確認（厳格チェック）

チケットファイルの以下のセクションを確認：

1. **localhost動作確認済み**かどうかを確認
   - チケットのメモセクションに「localhost動作確認済み」の記録があるか
   - または、ユーザーに直接「localhostで動作確認済みですか？」と質問する

2. **実装タスク**がすべて完了しているか確認
3. **変更対象ファイル**がすべて更新されているか確認
4. **テスト計画**のすべてのテストが完了しているか確認
5. **完了条件**がすべて満たされているか確認

**localhost動作確認が未完了の場合**:
```markdown
⚠️ エラー: localhost での動作確認が必要です

このチケットを完了する前に、以下を実施してください:

1. 開発サーバーを起動: `npm run dev`
2. ブラウザで改善効果を確認
3. 確認後、「動作確認OK」と返信してください

動作確認なしではチケットを完了できません。
```

**その他の項目が完了していない場合**:
```markdown
⚠️ 警告: 以下の項目が未完了です

- [ ] [未完了項目1]
- [ ] [未完了項目2]

これらの項目を完了してから、再度 `/complete-enhancement {{ticket_number}}` を実行してください。
```

**重要**: localhost動作確認が完了していない場合は、この時点で処理を中断してください。ユーザーに確認を求め、承認されたら次に進む。

### ステップ4: 実績時間の計算

チケットファイルから開始日時を取得し、実績時間を計算：

```
開始日時: [チケットから取得]
完了日時: [現在の日時]
実績時間: [差分を時間・分単位で計算]
```

### ステップ5: チケットファイルの更新（完了）

チケットファイル (`docs/ticket/enhancement/enhancement-{{ticket_number_padded}}-*.md`) を以下のように更新：

#### 5-1. ステータス・日時の更新
```markdown
**ステータス**: 🟢 完了
**完了日時**: [現在の日時 YYYY-MM-DD HH:MM]
**実績時間**: [計算した実績時間] (例: 1時間45分)
```

#### 5-2. 実装タスクの更新
`## ✅ 実装タスク` セクションの各項目を `- [ ]` → `- [x]` に更新

#### 5-3. 変更対象ファイルの更新
`## 📦 変更対象ファイル` セクションの各項目を `- [ ]` → `- [x]` に更新

#### 5-4. テスト計画の更新
すべてのテスト項目（回帰テスト/パフォーマンステスト等）を `- [ ]` → `- [x]` に更新

#### 5-5. ビフォー・アフター比較の更新（該当する場合）
`## 🧪 ビフォー・アフター比較` テーブルのAfter列とimprovement率を記録

#### 5-6. 完了条件の更新
`## 📊 完了条件` セクションの各項目を `- [ ]` → `- [x]` に更新

#### 5-7. メモセクションへの完了記録
`## 📝 メモ` セクションに以下を追記：

```markdown
### 完了記録
完了日時: [現在の日時]
実績時間: [実績時間]
見積時間: [チケットの見積時間]
Git commit: [後で記録]

#### 改善効果
- [改善効果1]
- [改善効果2]
- [改善効果3]

#### 最終確認
- [x] すべての改善が実装されている
- [x] 既存機能に影響がない
- [x] すべてのテストがパス
- [x] TypeScriptエラーなし
- [x] パフォーマンス目標達成（該当する場合）
```

**必ず実際にファイルを編集してチケットを更新してください。**

### ステップ6: PROGRESS.md更新（完了）

`docs/ticket/enhancement/PROGRESS.md` を更新：

#### 6-1. 全体進捗バーの更新
```
進捗: ████████████████░░░░ X% (Y/Z 改善)

実施中: N件 (-1)
計画中: N件
完了済み: N件 (+1)
```

#### 6-2. 現在実施中の改善セクションから削除
該当する改善エントリを削除

#### 6-3. 完了済み改善セクションに追加
```markdown
## ✅ 完了済み改善

### Enhancement #{{ticket_number_padded}}: [タイトル] ✅
- カテゴリ: [Performance/Refactoring/UX/Security/Code Quality]
- 優先度: [優先度]
- 完了日: [現在の日時]
- 実績時間: [実績時間]
- 改善効果: [簡潔な説明]
```

#### 6-4. 改善一覧セクションの更新
該当チケットのステータスを 🟡 進行中 → 🟢 完了 に更新

#### 6-5. 統計セクションの更新
- 完了数を+1
- 実施中を-1
- 平均実施時間を再計算

**必ず実際にファイルを編集してPROGRESS.mdを更新してください。**

### ステップ7: Gitコミットの作成

改善カテゴリに応じたコミットメッセージでGitコミットを作成：

**Performance改善の場合**:
```bash
git add .
git commit -m "$(cat <<'EOF'
perf([scope]): [改善の簡潔な説明]

Closes: enhancement-{{ticket_number_padded}}

改善内容:
- [改善内容1]
- [改善内容2]

パフォーマンス改善:
- [指標1]: [改善率]
- [指標2]: [改善率]

実績時間: [実績時間]

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

**Refactoring改善の場合**:
```bash
git add .
git commit -m "$(cat <<'EOF'
refactor([scope]): [改善の簡潔な説明]

Closes: enhancement-{{ticket_number_padded}}

リファクタリング内容:
- [内容1]
- [内容2]

実績時間: [実績時間]

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

**その他の改善**:
- UX改善: `style([scope]):`
- Security改善: `security([scope]):`
- Code Quality改善: `chore([scope]):`

### ステップ8: チケットファイルにコミット情報を追記

Gitコミット作成後、コミットハッシュを取得してチケットファイルに追記：

```bash
# コミットハッシュを取得
git log -1 --format='%H'
```

メモセクションのGit commit欄を更新：
```markdown
Git commit: [コミットハッシュ]
```

**必ず実際にファイルを編集してチケットファイルを更新してください。**

### ステップ9: チケット更新を再コミット

チケットファイルにコミット情報を追記した変更を再度コミット：

```bash
git add docs/ticket/enhancement/enhancement-{{ticket_number_padded}}-*.md
git commit -m "$(cat <<'EOF'
docs(ticket): enhancement-{{ticket_number_padded}}チケットにコミット情報を記録

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

### ステップ10: 完了レポートの表示

以下の形式で改善チケット完了を報告：

```markdown
## ✅ Enhancement #{{ticket_number_padded}} 完了

### 📋 改善実施サマリー
- **チケット**: enhancement-{{ticket_number_padded}}
- **タイトル**: [タイトル]
- **カテゴリ**: [Performance/Refactoring/UX/Security/Code Quality]
- **優先度**: [優先度]
- **見積時間**: [見積時間]
- **実績時間**: [実績時間]
- **完了日時**: [現在の日時]

### 🎯 改善内容
- [改善内容1]
- [改善内容2]
- [改善内容3]

### 📦 変更したファイル
- [ファイル1]
- [ファイル2]
- [ファイル3]

### 📊 改善効果（該当する場合）
| 指標 | Before | After | 改善率 |
|------|--------|-------|--------|
| [指標1] | [値] | [値] | [%] |
| [指標2] | [値] | [値] | [%] |

### ✅ テスト結果
- [x] 既存機能の回帰テスト: すべてパス
- [x] パフォーマンステスト: 目標達成
- [x] TypeScriptエラーなし
- [x] ビルド成功

### 📊 Git情報
- **コミット**: [コミットハッシュ]
- **コミットメッセージ**: [perf/refactor/style/security/chore]([scope]): [説明]

### 🎉 完了

Enhancement #{{ticket_number_padded}} の改善が完了しました！

---

### 📝 次のアクション

他のチケットを確認:
- `/list-tickets` - チケット一覧を表示
- `/ticket-status` - 全体進捗を確認

新しいチケットに着手:
- `/start-enhancement [番号]` - 次の改善を開始
```

---

## ⚠️ 重要な注意事項

1. **すべての完了条件を満たしてから完了**してください
2. **チケットファイルとPROGRESS.mdは必ず更新**してください
3. **既存機能への影響がないことを必ず確認**してください
4. **改善効果を定量的に測定**できる場合は記録してください
5. **実績時間は正確に記録**してください
6. **Gitコミットは必ず作成**してください

---

## 🚀 実行開始

上記の手順に従って、Enhancement #{{ticket_number}} の完了処理を開始してください。

**重要**: ステップ9のチケット更新の再コミットを必ず実行してください。
